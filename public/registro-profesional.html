<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro Profesional</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">

<div class="container d-flex align-items-center justify-content-center min-vh-100">
  <div class="card bg-black text-white shadow-lg" style="max-width: 520px; width: 100%;">
    <div class="card-body p-4">
      <div class="d-flex align-items-center mb-3">
        <i class="bi bi-briefcase-fill fs-2 me-2"></i>
        <h3 class="m-0">Registro de Profesional</h3>
      </div>

      <!-- Formulario de registro -->
      <form id="formRegistroProfesional">

        <div class="mb-3">
          <label class="form-label">Nombre</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-person"></i></span>
            <input type="text" class="form-control bg-dark text-white border-secondary" name="nombre" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Apellido</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-person-vcard"></i></span>
            <input type="text" class="form-control bg-dark text-white border-secondary" name="apellido" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">DNI</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-credit-card-2-front"></i></span>
            <input type="text" class="form-control bg-dark text-white border-secondary" name="dni" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Alias de Usuario</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-person-badge"></i></span>
            <input type="text" class="form-control bg-dark text-white border-secondary" name="alias" required>
          </div>
          <small class="text-muted">Este será tu nombre de usuario para iniciar sesión</small>
        </div>

        <div class="mb-3">
          <label class="form-label">Contraseña</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-lock"></i></span>
            <input type="password" class="form-control bg-dark text-white border-secondary" name="password" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Confirmar Contraseña</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-lock-fill"></i></span>
            <input type="password" class="form-control bg-dark text-white border-secondary" name="confirmPassword" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Oficio</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-tools"></i></span>
            <input type="text" class="form-control bg-dark text-white border-secondary" name="oficio" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Dirección</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-geo-alt"></i></span>
            <input type="text" class="form-control bg-dark text-white border-secondary" name="direccion" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">
            <i class="bi bi-geo-alt-fill"></i> Barrios donde trabaja
          </label>
          <div class="border border-secondary rounded p-3 bg-dark" style="max-height: 200px; overflow-y: auto;">
            <div class="row g-2" id="barriosContainer">
              <!-- Los checkboxes se generarán dinámicamente -->
            </div>
          </div>
          <div class="mt-2">
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="seleccionarTodosBarrios()">
              <i class="bi bi-check-all"></i> Seleccionar Todos
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm ms-2" onclick="deseleccionarTodosBarrios()">
              <i class="bi bi-x-square"></i> Deseleccionar Todos
            </button>
            <span class="badge bg-info ms-2" id="barriosSeleccionados">0 barrios seleccionados</span>
          </div>
          <small class="text-muted">Marca todos los barrios donde trabajas. Puedes seleccionar múltiples barrios.</small>
        </div>

        <div class="mb-4">
          <label class="form-label">Teléfono</label>
          <div class="input-group">
            <span class="input-group-text bg-dark text-white border-secondary"><i class="bi bi-telephone"></i></span>
            <input type="tel" class="form-control bg-dark text-white border-secondary" name="telefono" required>
          </div>
        </div>

        <button type="submit" class="btn btn-success w-100" id="btnSubmit">
          <span id="btnText">Registrarme</span>
          <span id="btnSpinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
        </button>
        <a href="index.html" class="btn btn-outline-light w-100 mt-2"><i class="bi bi-arrow-left"></i> Volver al inicio</a>
      </form>
    </div>
  </div>
</div>

<!-- Toast para mostrar mensajes -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto" id="toastTitle">Mensaje</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body" id="toastBody">
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const form = document.getElementById('formRegistroProfesional');
  const btnSubmit = document.getElementById('btnSubmit');
  const btnText = document.getElementById('btnText');
  const btnSpinner = document.getElementById('btnSpinner');
  
  // Lista de barrios de Buenos Aires
  const barrios = [
    'Agronomía', 'Almagro', 'Balvanera', 'Barracas', 'Belgrano', 'Boedo', 'Caballito', 'Chacarita', 'Colegiales', 'Constitución',
    'Flores', 'Floresta', 'La Boca', 'La Paternal', 'Liniers', 'Mataderos', 'Monserrat', 'Monte Castro', 'Nueva Pompeya', 'Núñez',
    'Palermo', 'Parque Avellaneda', 'Parque Chacabuco', 'Parque Chas', 'Parque Patricios', 'Puerto Madero', 'Recoleta', 'Retiro',
    'Saavedra', 'San Cristóbal', 'San Nicolás', 'San Telmo', 'Versalles', 'Villa Crespo', 'Villa del Parque', 'Villa Devoto',
    'Villa General Mitre', 'Villa Lugano', 'Villa Luro', 'Villa Ortúzar', 'Villa Pueyrredón', 'Villa Real', 'Villa Riachuelo',
    'Villa Santa Rita', 'Villa Soldati', 'Villa Urquiza', 'Vélez Sársfield'
  ];
  
  // Generar checkboxes de barrios
  function generarCheckboxesBarrios() {
    const container = document.getElementById('barriosContainer');
    const mitad = Math.ceil(barrios.length / 2);
    
    // Columna izquierda
    const colIzq = document.createElement('div');
    colIzq.className = 'col-md-6';
    
    // Columna derecha
    const colDer = document.createElement('div');
    colDer.className = 'col-md-6';
    
    barrios.forEach((barrio, index) => {
      const formCheck = document.createElement('div');
      formCheck.className = 'form-check';
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.className = 'form-check-input';
      checkbox.value = barrio;
      checkbox.name = 'barrios';
      checkbox.id = `barrio_${barrio.toLowerCase().replace(/\s+/g, '_').replace(/[áéíóúñ]/g, match => {
        const map = { 'á': 'a', 'é': 'e', 'í': 'i', 'ó': 'o', 'ú': 'u', 'ñ': 'n' };
        return map[match];
      })}`;
      checkbox.addEventListener('change', actualizarContadorBarrios);
      
      const label = document.createElement('label');
      label.className = 'form-check-label text-white';
      label.htmlFor = checkbox.id;
      label.textContent = barrio;
      
      formCheck.appendChild(checkbox);
      formCheck.appendChild(label);
      
      if (index < mitad) {
        colIzq.appendChild(formCheck);
      } else {
        colDer.appendChild(formCheck);
      }
    });
    
    container.appendChild(colIzq);
    container.appendChild(colDer);
  }
  
  // Actualizar contador de barrios seleccionados
  function actualizarContadorBarrios() {
    const seleccionados = document.querySelectorAll('input[name="barrios"]:checked').length;
    document.getElementById('barriosSeleccionados').textContent = `${seleccionados} barrios seleccionados`;
  }
  
  // Seleccionar todos los barrios
  function seleccionarTodosBarrios() {
    const checkboxes = document.querySelectorAll('input[name="barrios"]');
    checkboxes.forEach(checkbox => checkbox.checked = true);
    actualizarContadorBarrios();
  }
  
  // Deseleccionar todos los barrios
  function deseleccionarTodosBarrios() {
    const checkboxes = document.querySelectorAll('input[name="barrios"]');
    checkboxes.forEach(checkbox => checkbox.checked = false);
    actualizarContadorBarrios();
  }
  
  // Generar checkboxes cuando se carga la página
  document.addEventListener('DOMContentLoaded', function() {
    generarCheckboxesBarrios();
  });
  
  // Función para mostrar toast
  function mostrarToast(titulo, mensaje, tipo = 'success') {
    const toast = document.getElementById('toast');
    const toastTitle = document.getElementById('toastTitle');
    const toastBody = document.getElementById('toastBody');
    
    toastTitle.textContent = titulo;
    toastBody.textContent = mensaje;
    
    toast.className = `toast ${tipo === 'error' ? 'border-danger' : 'border-success'}`;
    
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
  }
  
  // Función para mostrar/ocultar loading
  function toggleLoading(mostrar) {
    if (mostrar) {
      btnText.textContent = 'Registrando...';
      btnSpinner.style.display = 'inline-block';
      btnSubmit.disabled = true;
    } else {
      btnText.textContent = 'Registrarme';
      btnSpinner.style.display = 'none';
      btnSubmit.disabled = false;
    }
  }
  
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Mostrar loading
    toggleLoading(true);
    
    // Obtener barrios seleccionados
    const barriosCheckboxes = document.querySelectorAll('input[name="barrios"]:checked');
    const barriosSeleccionados = Array.from(barriosCheckboxes).map(checkbox => checkbox.value);
    
    // Tomar los valores del formulario
    const data = {
      nombre: form.nombre.value.trim(),
      apellido: form.apellido.value.trim(),
      documento: form.dni.value.trim(),
      alias: form.alias.value.trim(),
      password: form.password.value,
      oficio: form.oficio.value.trim(),
      direccion: form.direccion.value.trim(),
      telefono: form.telefono.value.trim(),
      barrios_trabajo: barriosSeleccionados,
      foto: "" // Por ahora vacío
    };
    
    // Validaciones básicas
    if (!data.nombre || !data.apellido || !data.documento || !data.alias || !data.password || !data.oficio || !data.direccion || !data.telefono) {
      mostrarToast('Error', 'Por favor completa todos los campos', 'error');
      toggleLoading(false);
      return;
    }

    // Validar que se hayan seleccionado barrios
    if (barriosSeleccionados.length === 0) {
      mostrarToast('Error', 'Debes seleccionar al menos un barrio donde trabajas', 'error');
      toggleLoading(false);
      return;
    }

    // Validar contraseñas
    if (data.password !== form.confirmPassword.value) {
      mostrarToast('Error', 'Las contraseñas no coinciden', 'error');
      toggleLoading(false);
      return;
    }

    // Validar longitud de contraseña
    if (data.password.length < 6) {
      mostrarToast('Error', 'La contraseña debe tener al menos 6 caracteres', 'error');
      toggleLoading(false);
      return;
    }
  
    try {
      const response = await fetch('http://localhost:3000/registro/profesional', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
  
      const result = await response.json();
      
      if (response.ok) {
        mostrarToast('¡Éxito!', result.mensaje);
        form.reset();
        // Redirigir al login después de 2 segundos
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 2000);
      } else {
        mostrarToast('Error', result.error || 'Error al registrar el profesional', 'error');
      }
    } catch (error) {
      console.error("Error:", error);
      mostrarToast('Error', 'Error de conexión. Verifica que el servidor esté ejecutándose.', 'error');
    } finally {
      toggleLoading(false);
    }
  });
</script>
  
</body>
</html>
