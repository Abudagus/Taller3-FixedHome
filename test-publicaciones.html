<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test Publicaciones - FIXEDHOME</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background-color: #1a1a1a; color: white; }
    .card { background-color: #2d2d2d; border: 1px solid #444; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>Test de Publicaciones con Fotos</h1>
    
    <div class="row" id="publicacionesContainer">
      <!-- Aquí se cargarán las publicaciones -->
    </div>
  </div>

  <!-- Modal para ampliar imágenes -->
  <div class="modal fade" id="modalAmpliarImagen" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark text-white">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-image"></i> Foto del Problema
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <img id="imagenAmpliada" src="" alt="Foto del problema" class="img-fluid" style="max-height: 70vh;">
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Datos de prueba
    const publicacionesPrueba = [
      {
        id: 1,
        titulo: "Problema con la instalación eléctrica",
        descripcion: "Necesito un electricista para revisar la instalación de mi casa. Hay problemas con los interruptores y algunas luces no funcionan correctamente.",
        barrio: "Almagro",
        horarios_disponibles: "Lunes a Viernes de 9:00 a 18:00",
        fotos: JSON.stringify(["https://via.placeholder.com/300x200/ff6b6b/fff?text=Foto+1", "https://via.placeholder.com/300x200/4ecdc4/fff?text=Foto+2"]),
        estado: "activa",
        fecha_publicacion: "2024-01-15T10:30:00Z"
      },
      {
        id: 2,
        titulo: "Fuga de agua en el baño",
        descripcion: "Hay una fuga de agua en el baño principal que está causando humedad en la pared.",
        barrio: "Palermo",
        horarios_disponibles: "Fines de semana",
        fotos: JSON.stringify(["https://via.placeholder.com/300x200/45b7d1/fff?text=Foto+Fuga"]),
        estado: "activa",
        fecha_publicacion: "2024-01-14T15:45:00Z"
      }
    ];

    // Función para mostrar publicaciones
    function mostrarPublicaciones(publicaciones) {
      const container = document.getElementById('publicacionesContainer');
      
      const html = publicaciones.map(publicacion => `
        <div class="col-12 mb-4">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">${publicacion.titulo}</h5>
              <span class="badge bg-success">${publicacion.estado}</span>
            </div>
            <div class="card-body">
              <p class="card-text">${publicacion.descripcion}</p>
              
              <!-- Mostrar fotos si existen -->
              ${(() => {
                let fotos = [];
                if (publicacion.fotos) {
                  if (typeof publicacion.fotos === 'string') {
                    try {
                      fotos = JSON.parse(publicacion.fotos);
                    } catch (e) {
                      fotos = [];
                    }
                  } else if (Array.isArray(publicacion.fotos)) {
                    fotos = publicacion.fotos;
                  }
                }
                
                if (fotos.length > 0) {
                  return `
                    <div class="mt-3">
                      <strong><i class="bi bi-camera"></i> Fotos del problema:</strong>
                      <div class="d-flex flex-wrap gap-2 mt-2">
                        ${fotos.map(foto => `
                          <img src="${foto}" alt="Foto del problema" class="img-thumbnail" style="width: 100px; height: 100px; object-fit: cover; cursor: pointer;" 
                               onerror="this.style.display='none'" onclick="ampliarImagen('${foto}')">
                        `).join('')}
                      </div>
                    </div>
                  `;
                }
                return '';
              })()}
              
              <div class="row mt-3">
                <div class="col-md-6">
                  <strong><i class="bi bi-geo-alt"></i> Barrio:</strong> ${publicacion.barrio}
                </div>
                <div class="col-md-6">
                  <strong><i class="bi bi-clock"></i> Horarios:</strong> ${publicacion.horarios_disponibles || 'No especificado'}
                </div>
              </div>
              <div class="mt-2">
                <small class="text-muted">
                  <i class="bi bi-calendar"></i> Publicado: ${new Date(publicacion.fecha_publicacion).toLocaleDateString('es-ES')}
                </small>
              </div>
            </div>
          </div>
        </div>
      `).join('');
      
      container.innerHTML = html;
    }

    // Función para ampliar imagen
    function ampliarImagen(src) {
      document.getElementById('imagenAmpliada').src = src;
      const modal = new bootstrap.Modal(document.getElementById('modalAmpliarImagen'));
      modal.show();
    }

    // Cargar publicaciones al iniciar
    document.addEventListener('DOMContentLoaded', function() {
      mostrarPublicaciones(publicacionesPrueba);
    });
  </script>
</body>
</html>

